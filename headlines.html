<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Headline Stream</title>

  <style>
    :root{
      --bg0:#05080a;
      --bg1:#0a1116;
      --panel:#0b141aee;
      --stroke:#1b2a32;
      --glow:#46f3d0;
      --text:#eaf2f7;
      --muted:#a8b9c6;
      --chip:#0b2022;
      --chipStroke:#1c3c3a;
      --danger:#ff6b6b;
    }

    html,body{
      height:100%;
      margin:0;
      background: radial-gradient(1200px 700px at 15% 0%, #163642 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg0), var(--bg1));
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      overflow:hidden;
    }

    .wrap{
      position:relative;
      height:100%;
      padding:18px 18px 14px 18px;
      box-sizing:border-box;
    }

    /* Top bar */
    .top{
      height:72px;
      display:flex;
      align-items:center;
      gap:18px;
      padding:14px 16px;
      border-radius:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.08);
      box-shadow: 0 18px 60px rgba(0,0,0,0.55);
      backdrop-filter: blur(10px);
    }

    .time{
      font-size:56px;
      font-weight:800;
      letter-spacing:-1.5px;
      line-height:1;
      opacity:0.95;
      text-shadow: 0 12px 30px rgba(0,0,0,0.55);
      white-space:nowrap;
    }

    .titleBlock{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }

    .headlineStream{
      font-size:22px;
      letter-spacing:0.18em;
      opacity:0.8;
    }
    .subline{
      font-size:18px;
      color:var(--muted);
      opacity:0.9;
    }

    .status{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap:10px;
      font-size:14px;
      color:var(--muted);
      opacity:0.9;
      white-space:nowrap;
    }

    .dot{
      width:9px;height:9px;border-radius:50%;
      background:var(--glow);
      box-shadow: 0 0 0 4px rgba(70,243,208,0.12), 0 0 18px rgba(70,243,208,0.45);
    }

    /* Main card */
    .card{
      margin-top:14px;
      height:calc(100% - 72px - 14px);
      border-radius:22px;
      background:
        radial-gradient(900px 500px at 80% 20%, rgba(70,243,208,0.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.08);
      box-shadow: 0 18px 70px rgba(0,0,0,0.6);
      overflow:hidden;
      position:relative;
      backdrop-filter: blur(10px);
    }

    .card::before{
      content:"";
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(135deg, rgba(255,255,255,0.04) 0, rgba(255,255,255,0.04) 2px, transparent 2px, transparent 12px);
      opacity:0.35;
      pointer-events:none;
      mix-blend-mode: overlay;
    }

    .inner{
      position:relative;
      height:100%;
      padding:22px 22px 18px 22px;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .row{
      display:flex;
      align-items:center;
      gap:14px;
      min-width:0;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      border-radius:999px;
      background: linear-gradient(180deg, rgba(70,243,208,0.12), rgba(70,243,208,0.05));
      border:1px solid rgba(70,243,208,0.25);
      font-weight:700;
      letter-spacing:0.12em;
      color:#dffcf6;
      text-transform:uppercase;
      flex:0 0 auto;
    }

    .meta{
      color:var(--muted);
      font-size:20px;
      font-weight:600;
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .bigTitle{
      font-size:64px;
      line-height:1.02;
      font-weight:900;
      letter-spacing:-1.3px;
      margin-top:4px;
      text-shadow: 0 18px 60px rgba(0,0,0,0.55);
      max-height: 2.3em;
      overflow:hidden;
    }

    .summary{
      font-size:28px;
      color:#d6e3ec;
      opacity:0.95;
      max-width: 1200px;
    }

    .footer{
      margin-top:auto;
      display:flex;
      align-items:center;
      gap:14px;
      color:var(--muted);
      font-size:14px;
      opacity:0.9;
    }

    .pill{
      padding:8px 12px;
      border-radius:999px;
      background: rgba(0,0,0,0.25);
      border:1px solid rgba(255,255,255,0.10);
      display:inline-flex;
      align-items:center;
      gap:10px;
      white-space:nowrap;
    }

    .btn{
      cursor:pointer;
      user-select:none;
      padding:8px 12px;
      border-radius:12px;
      background: rgba(0,0,0,0.25);
      border:1px solid rgba(255,255,255,0.12);
      color:var(--text);
      font-weight:700;
    }
    .btn:active{ transform: translateY(1px); }

    .err{
      color: var(--danger);
      font-weight:700;
    }

    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration: underline; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="time" id="clock">--:--</div>
      <div class="titleBlock">
        <div class="headlineStream">HEADLINE STREAM</div>
        <div class="subline">Markets • Tech • AZ • NFL • World • Editing • Gaming</div>
      </div>
      <div class="status">
        <span id="updated">Updating…</span>
        <span class="dot"></span>
      </div>
    </div>

    <div class="card">
      <div class="inner">
        <div class="row">
          <div class="chip" id="chip">LOADING</div>
          <div class="meta" id="meta">—</div>
        </div>

        <div class="bigTitle" id="title">Fetching headlines…</div>
        <div class="summary" id="summary">Please wait.</div>

        <div class="footer">
          <div class="pill" id="sourcePill">Source: —</div>
          <div class="pill" id="idxPill">Item — / —</div>
          <div class="pill">Auto: <span id="autoPill">90s</span></div>

          <div style="margin-left:auto; display:flex; gap:10px;">
            <div class="btn" id="prevBtn">◀</div>
            <div class="btn" id="nextBtn">▶</div>
            <div class="btn" id="openBtn">Open</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  const API = "/api/headlines?limit=50&reddit=1";

  // 60–120 seconds feels good on an Edge panel
  let ROTATE_MS = 90_000;

  let items = [];
  let idx = 0;
  let timer = null;

  const el = (id) => document.getElementById(id);

  function tickClock(){
    const d = new Date();
    const h = d.getHours();
    const m = String(d.getMinutes()).padStart(2,"0");
    const ampm = h >= 12 ? "PM" : "AM";
    const hh = ((h + 11) % 12 + 1);
    el("clock").textContent = `${hh}:${m} ${ampm}`;
  }

  function setUpdatedLabel(text){
    el("updated").textContent = text;
  }

  function showItem(i){
    if (!items.length) return;

    const x = items[i % items.length];
    idx = i % items.length;

    el("chip").textContent = (x.category || "NEWS").toUpperCase();
    el("meta").textContent = x.source ? `${x.source}` : "—";
    el("title").textContent = x.title || "—";
    el("summary").textContent = x.summary || "Summary unavailable.";
    el("sourcePill").innerHTML = `Source: <a href="${x.url}" target="_blank" rel="noreferrer">${escapeHtml(x.url)}</a>`;
    el("idxPill").textContent = `Item ${idx + 1} / ${items.length}`;

    // store current URL for Open button
    el("openBtn").dataset.url = x.url || "";
  }

  function next(){
    showItem(idx + 1);
  }

  function prev(){
    showItem((idx - 1 + items.length) % items.length);
  }

  function startRotate(){
    stopRotate();
    el("autoPill").textContent = Math.round(ROTATE_MS/1000) + "s";
    timer = setInterval(next, ROTATE_MS);
  }

  function stopRotate(){
    if (timer) clearInterval(timer);
    timer = null;
  }

  async function load(){
    setUpdatedLabel("Updating…");
    try{
      const r = await fetch(API, { cache: "no-store" });
      const data = await r.json();

      if (!data.ok) throw new Error(data.error || "API error");

      items = data.items || [];
      if (!items.length) throw new Error("No items returned");

      // randomize slightly so you don’t always see the same first headline
      idx = Math.floor(Math.random() * items.length);
      showItem(idx);

      const now = new Date();
      setUpdatedLabel("Updated " + now.toLocaleTimeString([], {hour:"numeric", minute:"2-digit"}));
      startRotate();
    }catch(e){
      el("chip").textContent = "ERROR";
      el("title").textContent = "Couldn’t load headlines";
      el("summary").innerHTML = `<span class="err">${escapeHtml(String(e.message || e))}</span>`;
      setUpdatedLabel("Error");
      stopRotate();
    }
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }

  // Controls
  el("nextBtn").addEventListener("click", () => { next(); startRotate(); });
  el("prevBtn").addEventListener("click", () => { prev(); startRotate(); });
  el("openBtn").addEventListener("click", () => {
    const u = el("openBtn").dataset.url;
    if (u) window.open(u, "_blank", "noopener,noreferrer");
  });

  // Boot
  tickClock();
  setInterval(tickClock, 1000);
  load();
  // Refresh the feed list every ~10 minutes (without redeploying)
  setInterval(load, 10 * 60 * 1000);
</script>
</body>
</html>
