<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Phoenix Radar</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #05080c;
  color: #e6f1ff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  height: 100%;
}

.radar-wrapper {
  position: relative;
  width: 100%;
  height: 100vh;
  overflow: hidden;
  border-radius: 16px;
}

.radar {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  transition: background-image 0.4s ease;
}

/* Dark overlay + scan texture */
.radar::after {
  content: "";
  position: absolute;
  inset: 0;
  background:
    repeating-linear-gradient(
      135deg,
      rgba(255,255,255,0.03) 0px,
      rgba(255,255,255,0.03) 2px,
      transparent 2px,
      transparent 6px
    );
  pointer-events: none;
}

.header {
  position: absolute;
  top: 14px;
  left: 18px;
  font-size: 18px;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.zoom-controls {
  position: absolute;
  top: 14px;
  right: 18px;
  display: flex;
  gap: 8px;
}

.zoom-controls button {
  background: rgba(0, 180, 160, 0.15);
  color: #7fffe6;
  border: 1px solid rgba(0,180,160,0.35);
  padding: 6px 10px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 12px;
}

.zoom-controls button.active {
  background: rgba(0,180,160,0.35);
}

.footer {
  position: absolute;
  bottom: 14px;
  left: 18px;
  font-size: 13px;
  opacity: 0.85;
}

.footer span {
  display: block;
  font-size: 11px;
  opacity: 0.6;
}
</style>
</head>

<body>

<div class="radar-wrapper">
  <div id="radar" class="radar"></div>

  <div class="header">
    PHOENIX WEATHER RADAR
  </div>

  <div class="zoom-controls">
    <button onclick="setZoom(11)" id="z11">Metro</button>
    <button onclick="setZoom(9)" id="z9" class="active">Valley</button>
    <button onclick="setZoom(7)" id="z7">Regional</button>
  </div>

  <div class="footer">
    Live radar Â· RainViewer
    <span>Shows measurable reflectivity (light drizzle may be faint)</span>
  </div>
</div>

<script>
const LAT = 33.4484;
const LON = -112.0740;

// Convert lat/lon to tile X/Y
function lon2tile(lon, zoom) {
  return Math.floor((lon + 180) / 360 * Math.pow(2, zoom));
}
function lat2tile(lat, zoom) {
  return Math.floor(
    (1 - Math.log(Math.tan(lat * Math.PI / 180) +
    1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 *
    Math.pow(2, zoom)
  );
}

let currentZoom = 9;

function setZoom(z) {
  currentZoom = z;
  document.querySelectorAll(".zoom-controls button")
    .forEach(b => b.classList.remove("active"));
  document.getElementById("z"+z).classList.add("active");
  updateRadar();
}

function updateRadar() {
  const x = lon2tile(LON, currentZoom);
  const y = lat2tile(LAT, currentZoom);
  const ts = Math.floor(Date.now() / 1000 / 300) * 300;

  const url = `https://tilecache.rainviewer.com/v2/radar/${ts}/${currentZoom}/${x}/${y}/2/1_0.png`;

  document.getElementById("radar").style.backgroundImage =
    `url("${url}")`;
}

updateRadar();
setInterval(updateRadar, 300000); // refresh every 5 min
</script>

</body>
</html>
